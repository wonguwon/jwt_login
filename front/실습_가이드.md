# JWT & OAuth2 ì‹¤ìŠµ ê°€ì´ë“œ ğŸ› ï¸

## ğŸ“‹ ì‹¤ìŠµ ëª©í‘œ
ì´ ê°€ì´ë“œë¥¼ ë”°ë¼í•˜ë©´ì„œ ì‹¤ì œë¡œ JWTì™€ OAuth2 ë¡œê·¸ì¸ ì‹œìŠ¤í…œì„ êµ¬í˜„í•´ë³´ì„¸ìš”!

---

## ğŸš€ 1ë‹¨ê³„: í”„ë¡œì íŠ¸ ì‹¤í–‰

### 1-1. ë°±ì—”ë“œ ì„œë²„ ì‹¤í–‰
```bash
cd oauth
./gradlew bootRun
```
- ì„œë²„ê°€ http://localhost:8080 ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤
- MySQL ë°ì´í„°ë² ì´ìŠ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤ (í¬íŠ¸ 3306)

### 1-2. í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ ì‹¤í–‰
```bash
cd oauth-react
npm run dev
```
- React ì•±ì´ http://localhost:3000 ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤

---

## ğŸ” 2ë‹¨ê³„: íšŒì›ê°€ì… ê³¼ì • ë”°ë¼í•˜ê¸°

### 2-1. ë¸Œë¼ìš°ì €ì—ì„œ í™•ì¸
1. http://localhost:3000 ì ‘ì†
2. "íšŒì›ê°€ì…" ë²„íŠ¼ í´ë¦­
3. ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
4. "ë“±ë¡" ë²„íŠ¼ í´ë¦­

### 2-2. ê°œë°œì ë„êµ¬ì—ì„œ í™•ì¸
1. F12 í‚¤ë¥¼ ëˆŒëŸ¬ ê°œë°œì ë„êµ¬ ì—´ê¸°
2. Network íƒ­ ì„ íƒ
3. íšŒì›ê°€ì… ë²„íŠ¼ í´ë¦­
4. `POST /member/create` ìš”ì²­ í™•ì¸

### 2-3. ìš”ì²­/ì‘ë‹µ í™•ì¸
```javascript
// ìš”ì²­ ë°ì´í„°
{
  "email": "test@example.com",
  "password": "password123"
}

// ì‘ë‹µ ë°ì´í„°
1  // ìƒì„±ëœ ì‚¬ìš©ì ID
```

---

## ğŸ” 3ë‹¨ê³„: ë¡œê·¸ì¸ ê³¼ì • ë”°ë¼í•˜ê¸°

### 3-1. ë¸Œë¼ìš°ì €ì—ì„œ í™•ì¸
1. "ë¡œê·¸ì¸" ë²„íŠ¼ í´ë¦­
2. ë°©ê¸ˆ ê°€ì…í•œ ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
3. "ë¡œê·¸ì¸" ë²„íŠ¼ í´ë¦­

### 3-2. ê°œë°œì ë„êµ¬ì—ì„œ í™•ì¸
1. Network íƒ­ì—ì„œ `POST /member/doLogin` ìš”ì²­ í™•ì¸
2. ì‘ë‹µì—ì„œ JWT í† í° í™•ì¸

### 3-3. JWT í† í° í™•ì¸
```javascript
// ì‘ë‹µ ë°ì´í„°
{
  "id": 1,
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ0ZXN0QGV4YW1wbGUuY29tIiwicm9sZSI6IlVTRVIiLCJpYXQiOjE2MzQ1Njc4OTAsImV4cCI6MTYzNDU3MTQ5MH0.abc123..."
}
```

### 3-4. localStorage í™•ì¸
1. Application íƒ­ ì„ íƒ
2. Local Storage > http://localhost:3000 í™•ì¸
3. `token` í‚¤ì— JWT í† í°ì´ ì €ì¥ëœ ê²ƒì„ í™•ì¸

---

## ğŸŒ 4ë‹¨ê³„: OAuth2 ì†Œì…œ ë¡œê·¸ì¸ ë”°ë¼í•˜ê¸°

### 4-1. Google ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
1. ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ Google ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­
2. Google ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ë˜ëŠ” ê²ƒ í™•ì¸
3. Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
4. ìš°ë¦¬ ì„œë¹„ìŠ¤ë¡œ ëŒì•„ì™€ì„œ JWT í† í° ë°œê¸‰ í™•ì¸

### 4-2. ê°œë°œì ë„êµ¬ì—ì„œ OAuth2 íë¦„ í™•ì¸
1. Network íƒ­ì—ì„œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ìš”ì²­ë“¤ í™•ì¸
2. `/oauth/google/redirect` ìš”ì²­ í™•ì¸
3. ìµœì¢… JWT í† í° ì‘ë‹µ í™•ì¸

---

## ğŸ”§ 5ë‹¨ê³„: ì½”ë“œ ë¶„ì„í•˜ê¸°

### 5-1. íšŒì›ê°€ì… ì½”ë“œ ë¶„ì„
```javascript
// React (MemberCreate.jsx)
const memberCreate = async (e) => {
  e.preventDefault()
  const registerData = {
    email: email,
    password: password
  }
  try {
    await axios.post("http://localhost:8080/member/create", registerData)
    window.location.href = "/"
  } catch (error) {
    alert("íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
  }
}
```

```java
// Spring Boot (MemberController.java)
@PostMapping("/create")
public ResponseEntity<?> memberCreate(@RequestBody MemberCreateDto memberCreateDto){
    Member member = memberService.create(memberCreateDto);
    return new ResponseEntity<>(member.getId(), HttpStatus.CREATED);
}
```

### 5-2. ë¡œê·¸ì¸ ì½”ë“œ ë¶„ì„
```javascript
// React (MemberLogin.jsx)
const memberLogin = async (e) => {
  e.preventDefault()
  const loginData = {
    email: email,
    password: password
  }
  try {
    const response = await axios.post("http://localhost:8080/member/doLogin", loginData)
    const token = response.data.token
    localStorage.setItem("token", token)
    window.location.href = "/"
  } catch (error) {
    alert("ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
  }
}
```

```java
// Spring Boot (MemberController.java)
@PostMapping("/doLogin")
public ResponseEntity<?> doLogin(@RequestBody MemberLoginDto memberLoginDto){
    Member member = memberService.login(memberLoginDto);
    String jwtToken = jwtTokenProvider.createToken(member.getEmail(), member.getRole().toString());
    
    Map<String, Object> loginInfo = new HashMap<>();
    loginInfo.put("id", member.getId());
    loginInfo.put("token", jwtToken);
    return new ResponseEntity<>(loginInfo, HttpStatus.OK);
}
```

### 5-3. OAuth2 ì½”ë“œ ë¶„ì„
```javascript
// React (GoogleRedirect.jsx)
const sendCodeToServer = async (code) => {
  try {
    const response = await axios.post("http://localhost:8080/member/google/doLogin", { code })
    const token = response.data.token
    localStorage.setItem("token", token)
    window.location.href = "/"
  } catch (error) {
    alert("Google ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
  }
}
```

```java
// Spring Boot (MemberController.java)
@PostMapping("/google/doLogin")
public ResponseEntity<?> googleLogin(@RequestBody RedirectDto redirectDto){
    // 1. ì¸ì¦ ì½”ë“œë¡œ ì•¡ì„¸ìŠ¤ í† í° ìš”ì²­
    AccessTokenDto accessTokenDto = googleService.getAccessToken(redirectDto.getCode());
    
    // 2. ì•¡ì„¸ìŠ¤ í† í°ìœ¼ë¡œ ì‚¬ìš©ì ì •ë³´ ìš”ì²­
    GoogleProfileDto googleProfileDto = googleService.getGoogleProfile(accessTokenDto.getAccess_token());
    
    // 3. ì‚¬ìš©ì ì •ë³´ë¡œ íšŒì›ê°€ì… ë˜ëŠ” ë¡œê·¸ì¸
    Member originalMember = memberService.getMemberBySocialId(googleProfileDto.getSub());
    if(originalMember == null){
        originalMember = memberService.createOauth(googleProfileDto.getSub(), googleProfileDto.getEmail(), SocialType.GOOGLE);
    }
    
    // 4. JWT í† í° ìƒì„±
    String jwtToken = jwtTokenProvider.createToken(originalMember.getEmail(), originalMember.getRole().toString());
    
    Map<String, Object> loginInfo = new HashMap<>();
    loginInfo.put("id", originalMember.getId());
    loginInfo.put("token", jwtToken);
    return new ResponseEntity<>(loginInfo, HttpStatus.OK);
}
```

---

## ğŸ§ª 6ë‹¨ê³„: ë””ë²„ê¹… ë° í…ŒìŠ¤íŠ¸

### 6-1. JWT í† í° ë””ì½”ë”©
1. [jwt.io](https://jwt.io) ì‚¬ì´íŠ¸ ì ‘ì†
2. localStorageì—ì„œ ë³µì‚¬í•œ í† í° ë¶™ì—¬ë„£ê¸°
3. í† í°ì˜ ë‚´ìš© í™•ì¸ (í˜ì´ë¡œë“œ ë¶€ë¶„)

### 6-2. API í…ŒìŠ¤íŠ¸
```bash
# íšŒì›ê°€ì… í…ŒìŠ¤íŠ¸
curl -X POST http://localhost:8080/member/create \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password123"}'

# ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
curl -X POST http://localhost:8080/member/doLogin \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password123"}'
```

### 6-3. CORS í…ŒìŠ¤íŠ¸
ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ì—ì„œ CORS ì˜¤ë¥˜ê°€ ì—†ëŠ”ì§€ í™•ì¸

---

## ğŸ¯ 7ë‹¨ê³„: ì‹¬í™” í•™ìŠµ

### 7-1. JWT í† í° ê²€ì¦ ê³¼ì • ì´í•´
```java
// JwtTokenFilter.javaì—ì„œ í† í° ê²€ì¦
@Override
protected void doFilterInternal(HttpServletRequest request, 
                              HttpServletResponse response, 
                              FilterChain filterChain) {
    String token = extractToken(request);
    if (token != null && jwtTokenProvider.validateToken(token)) {
        // ì¸ì¦ ì„±ê³µ - ìš”ì²­ ì²˜ë¦¬
    }
    filterChain.doFilter(request, response);
}
```

### 7-2. ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” ê³¼ì •
```java
// ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”
String encodedPassword = passwordEncoder.encode(password);

// ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
boolean matches = passwordEncoder.matches(rawPassword, encodedPassword);
```

### 7-3. OAuth2 ì¸ì¦ ì½”ë“œ íë¦„
```
1. ì‚¬ìš©ì â†’ Google: ì¸ì¦ ìš”ì²­
2. Google â†’ ì‚¬ìš©ì: ì¸ì¦ ì½”ë“œ ë°˜í™˜
3. ì‚¬ìš©ì â†’ ìš°ë¦¬ì„œë²„: ì¸ì¦ ì½”ë“œ ì „ì†¡
4. ìš°ë¦¬ì„œë²„ â†’ Google: ì•¡ì„¸ìŠ¤ í† í° ìš”ì²­
5. Google â†’ ìš°ë¦¬ì„œë²„: ì•¡ì„¸ìŠ¤ í† í° ë°˜í™˜
6. ìš°ë¦¬ì„œë²„ â†’ Google: ì‚¬ìš©ì ì •ë³´ ìš”ì²­
7. Google â†’ ìš°ë¦¬ì„œë²„: ì‚¬ìš©ì ì •ë³´ ë°˜í™˜
8. ìš°ë¦¬ì„œë²„ â†’ ì‚¬ìš©ì: JWT í† í° ë°˜í™˜
```

---

## ğŸš¨ 8ë‹¨ê³„: ë¬¸ì œ í•´ê²°

### 8-1. ì¼ë°˜ì ì¸ ì˜¤ë¥˜ë“¤

#### CORS ì˜¤ë¥˜
```
Access to XMLHttpRequest at 'http://localhost:8080/member/create' 
from origin 'http://localhost:3000' has been blocked by CORS policy
```
**í•´ê²°ë°©ë²•**: ë°±ì—”ë“œì˜ CORS ì„¤ì • í™•ì¸

#### ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì˜¤ë¥˜
```
Communications link failure
```
**í•´ê²°ë°©ë²•**: MySQL ì„œë²„ ì‹¤í–‰ í™•ì¸

#### JWT í† í° ì˜¤ë¥˜
```
JWT signature does not match locally computed signature
```
**í•´ê²°ë°©ë²•**: JWT ì‹œí¬ë¦¿ í‚¤ ì„¤ì • í™•ì¸

### 8-2. ë””ë²„ê¹… íŒ
1. **ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬** í™œìš©
2. **Spring Boot ë¡œê·¸** í™•ì¸
3. **ë°ì´í„°ë² ì´ìŠ¤ ì§ì ‘ í™•ì¸**
4. **Postmanìœ¼ë¡œ API í…ŒìŠ¤íŠ¸**

---

## âœ… ì‹¤ìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ê¸°ë³¸ ê¸°ëŠ¥
- [ ] íšŒì›ê°€ì… ì„±ê³µ
- [ ] ë¡œê·¸ì¸ ì„±ê³µ
- [ ] JWT í† í° ë°œê¸‰ í™•ì¸
- [ ] Google OAuth2 ë¡œê·¸ì¸ ì„±ê³µ
- [ ] Kakao OAuth2 ë¡œê·¸ì¸ ì„±ê³µ

### ì½”ë“œ ì´í•´
- [ ] React ì»´í¬ë„ŒíŠ¸ êµ¬ì¡° ì´í•´
- [ ] Spring Boot ì»¨íŠ¸ë¡¤ëŸ¬ ì´í•´
- [ ] JWT í† í° ìƒì„±/ê²€ì¦ ê³¼ì • ì´í•´
- [ ] OAuth2 íë¦„ ì´í•´

### ë³´ì•ˆ ì´í•´
- [ ] ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” í™•ì¸
- [ ] CORS ì„¤ì • ì´í•´
- [ ] JWT í† í° ë§Œë£Œ ì‹œê°„ ì„¤ì • í™•ì¸

---

## ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤!

ì´ì œ JWTì™€ OAuth2 ë¡œê·¸ì¸ ì‹œìŠ¤í…œì„ ì™„ì „íˆ ì´í•´í•˜ê³  êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!

### ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ:
1. **Refresh Token êµ¬í˜„**
2. **ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ ì¶”ê°€**
3. **ê¶Œí•œ ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬í˜„**
4. **ì‹¤ì œ ë°°í¬ í™˜ê²½ ì„¤ì •**

---

**ğŸ’¡ íŒ**: ì´ ì‹¤ìŠµì„ ì™„ë£Œí•œ í›„, ì‹¤ì œ í”„ë¡œì íŠ¸ì— ì ìš©í•´ë³´ì„¸ìš”! 